<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì£¼êµ° í˜ì´ì§• í†µí•© ì§€íœ˜ì†Œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f8faff; color: #333; margin: 0; padding: 0; text-align: center; }
        .container { max-width: 500px; margin: 0 auto; padding: 10px 20px; }
        
        /* ğŸ“± ìš°ì¸¡ ë°€ì°©í˜• ì‹œìŠ¤í…œ ìƒíƒœë°” */
        .system-bar { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 18px; font-weight: 600; font-size: 14px; color: #000;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px);
            position: sticky; top: 0; z-index: 1000;
        }
        .right-status { display: flex; align-items: center; gap: 5px; }
        .signal-bars { display: flex; align-items: flex-end; gap: 1.5px; height: 13px; margin: 0 2px; }
        .bar { width: 3px; background: #000; border-radius: 1px; }

        #total-balance { font-size: 45px; font-weight: 900; margin: 25px 0 10px 0; color: #222; letter-spacing: -1.5px; }
        .config-box { background: white; border-radius: 20px; padding: 12px; margin: 15px 0; border: 1px solid #eee; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .config-input { width: 90px; padding: 6px; border: 2px solid #d4af37; border-radius: 10px; font-weight: bold; text-align: center; font-size: 16px; outline: none; }
        
        .chart-box { background: white; border-radius: 30px; padding: 15px; margin: 15px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.03); height: 200px; border: 1px solid #f0f0f0; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 25px; }
        .btn { flex: 1; height: 60px; border-radius: 18px; border: none; font-weight: bold; color: white; cursor: pointer; font-size: 15px; }

        /* ğŸ”¢ í˜ì´ì§• ìˆ«ì í‘œì‹œ ë””ìì¸ */
        .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding-bottom: 30px; }
        .page-btn { padding: 8px 15px; border-radius: 10px; border: 1px solid #ddd; background: white; cursor: pointer; font-weight: bold; }
        .page-btn.active { background: #d4af37; color: white; border-color: #d4af37; }
        .page-btn:disabled { opacity: 0.3; cursor: default; }

        #emergency-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ff0000; color: white; z-index: 9999; flex-direction: column; align-items: center; justify-content: center;
        }
        .confirm-btn { margin-top: 40px; padding: 20px 80px; background: white; color: red; border-radius: 50px; border: none; font-size: 22px; font-weight: 900; }
    </style>
</head>
<body onload="init()">

    <div id="emergency-overlay">
        <h1 style="font-size: 100px; margin: 0;">ğŸš¨</h1>
        <h2 style="font-size: 36px; margin: 20px 0;">ê¸´ê¸‰ ì•ˆë³´ ìœ„ê¸°!</h2>
        <p id="msg" style="font-size: 22px; font-weight: bold;"></p>
        <button class="confirm-btn" onclick="closeEmergency()">ìƒí™© í™•ì¸</button>
    </div>

    <div class="system-bar">
        <div id="phone-time">00:00</div>
        <div class="right-status">
            <span style="font-size: 12px; font-weight: 900;">5G</span>
            <div class="signal-bars">
                <div class="bar" style="height: 35%;"></div>
                <div class="bar" style="height: 55%;"></div>
                <div class="bar" style="height: 75%;"></div>
                <div class="bar" id="signal-strength" style="height: 100%;"></div>
            </div>
            <span id="phone-battery">100%</span>
        </div>
    </div>

    <div class="container" onclick="startEngine()">
        <div style="font-size: 13px; color: #d4af37; font-weight: bold; margin-top: 15px;">ğŸ”± ì£¼êµ° 5G ì•ˆë³´ ë³¸ì§„</div>
        <div id="total-balance">427,985ì›</div>
        
        <div class="config-box">
            <span style="font-size: 15px; font-weight: bold;">ğŸš¨ ê²½ë³´ ê¸°ì¤€:</span>
            <input type="number" id="alert-limit" class="config-input" value="4000" onchange="saveLimit()">
            <span style="font-size: 15px; font-weight: bold;">ì›</span>
        </div>

        <div class="chart-box"><canvas id="assetChart"></canvas></div>

        <div class="btn-group">
            <button class="btn" style="background:#4a6cf7;" onclick="run('K-BANK')">ì¼€ì´ë±…í¬</button>
            <button class="btn" style="background:#03cf5d;" onclick="run('Ní˜ì´')">ë„¤ì´ë²„í˜ì´</button>
            <button class="btn" style="background:#d4af37;" onclick="run('ìˆ˜í˜ˆ')">ë¦¬ì›Œë“œ ìˆ˜í˜ˆ</button>
        </div>

        <div id="history-box"></div>
        <div id="pagination" class="pagination"></div>
    </div>

    <script>
        let balance = localStorage.getItem('bal_v13') ? parseInt(localStorage.getItem('bal_v13')) : 427985;
        let logs = localStorage.getItem('logs_v13') ? JSON.parse(localStorage.getItem('logs_v13')) : [];
        let limit = localStorage.getItem('limit_v13') ? parseInt(localStorage.getItem('limit_v13')) : 4000;
        let currentPage = 1;
        const itemsPerPage = 10;
        let myChart, siren, audioCtx;

        function init() {
            document.getElementById('alert-limit').value = limit;
            render(); initChart(); updateStatus();
            setInterval(updateStatus, 1000);
        }

        async function updateStatus() {
            const now = new Date();
            document.getElementById('phone-time').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            try {
                const battery = await navigator.getBattery();
                document.getElementById('phone-battery').innerText = `${Math.round(battery.level * 100)}%`;
                document.getElementById('signal-strength').style.opacity = Math.random() > 0.1 ? "1" : "0.4";
            } catch (e) {}
        }
        
        function saveLimit() { limit = parseInt(document.getElementById('alert-limit').value); localStorage.setItem('limit_v13', limit); }
        function startEngine() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
        function playSiren() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sawtooth'; osc.frequency.setValueAtTime(880, audioCtx.currentTime); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.15); }

        function run(type) {
            startEngine();
            const amtStr = prompt(`[${type}] ê¸ˆì•¡ ì…ë ¥`);
            if (amtStr && !isNaN(amtStr)) {
                const amt = parseInt(amtStr);
                if (type !== 'ìˆ˜í˜ˆ' && amt >= limit) {
                    document.getElementById('msg').innerText = `${amt.toLocaleString()}ì› ìœ ì¶œ ê°ì§€!`;
                    document.getElementById('emergency-overlay').style.display = 'flex';
                    siren = setInterval(playSiren, 500);
                    if(navigator.vibrate) navigator.vibrate([1000, 500, 1000]);
                }
                balance = (type === 'ìˆ˜í˜ˆ') ? balance + amt : balance - amt;
                logs.unshift({ type, amt: (type==='ìˆ˜í˜ˆ'?'+':'-')+amt.toLocaleString()+"ì›", time: new Date().toLocaleTimeString().slice(0,8), val: balance });
                localStorage.setItem('bal_v13', balance);
                localStorage.setItem('logs_v13', JSON.stringify(logs));
                currentPage = 1; // ìƒˆ ì…ë ¥ ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
                render(); updateChart();
            }
        }

        function closeEmergency() { document.getElementById('emergency-overlay').style.display = 'none'; clearInterval(siren); }

        function render() {
            document.getElementById('total-balance').innerText = balance.toLocaleString() + "ì›";
            const box = document.getElementById('history-box');
            box.innerHTML = '';
            
            const start = (currentPage - 1) * itemsPerPage;
            const pagedLogs = logs.slice(start, start + itemsPerPage);

            pagedLogs.forEach(l => {
                const c = l.amt.includes('+') ? '#00c853' : '#ff4d4f';
                box.innerHTML += `<div style="background:white; border-radius:18px; padding:15px; margin-bottom:10px; display:flex; justify-content:space-between; border:1px solid #f9f9f9;"><div><b>${l.type}</b><br><small style="color:#aaa;">${l.time}</small></div><div style="font-size:18px; font-weight:900; color:${c}">${l.amt}</div></div>`;
            });

            renderPagination();
        }

        function renderPagination() {
            const nav = document.getElementById('pagination');
            nav.innerHTML = '';
            const totalPages = Math.ceil(logs.length / itemsPerPage);
            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.onclick = (e) => { e.stopPropagation(); currentPage = i; render(); };
                nav.appendChild(btn);
            }
        }

        function initChart() {
            const ctx = document.getElementById('assetChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ data: [], borderColor: '#d4af37', tension: 0.4, fill: true, backgroundColor: 'rgba(212,175,55,0.05)', borderWidth: 4, pointRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: true } } }
            });
            updateChart();
        }

        function updateChart() {
            const d = logs.slice(0, 7).reverse();
            myChart.data.labels = d.map(l => l.time);
            myChart.data.datasets[0].data = d.map(l => l.val);
            myChart.update();
        }
    </script>
</body>
</html>
